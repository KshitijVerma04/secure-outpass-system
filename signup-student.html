<!DOCTYPE html>
<html>
<head>
  <title>Student Signup</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <h1>Student Registration</h1>
</header>

<div class="dashboard-container">
  <div class="card">

    <input id="name" placeholder="Full Name"><br><br>

    <input id="regNo" placeholder="Registration Number"><br><br>

    <input id="block" placeholder="Block"><br><br>

    <input id="roomNo" placeholder="Room Number"><br><br>

    <input id="parentEmail" placeholder="Parent Email"><br><br>

    <input id="email" type="email"
           placeholder="College Email (@muj.manipal.edu)"><br><br>

    <input id="password" type="password"
           placeholder="Password"><br><br>

    <button id="signupBtn">Register</button>

    <p id="message"></p>

  </div>
</div>


<script type="module">

import { auth, db } from "./firebase.js";

import {
  createUserWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  doc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


const message = document.getElementById("message");

document.getElementById("signupBtn")
.addEventListener("click", async () => {

  const name = document.getElementById("name").value.trim();
  const regNo = document.getElementById("regNo").value.trim();
  const block = document.getElementById("block").value.trim();
  const roomNo = document.getElementById("roomNo").value.trim();
  const parentEmail = document.getElementById("parentEmail").value.trim();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  // ‚úÖ Basic validation
  if (!name || !regNo || !block || !roomNo ||
      !parentEmail || !email || !password) {

    message.innerText = "Please fill all fields.";
    return;
  }

  // ‚úÖ College email restriction
  const normalizedEmail = email.toLowerCase();

if (!normalizedEmail.endsWith("@muj.manipal.edu")) {
  message.innerText =
    "Use your official MUJ college email.";
  return;
}


  try {

    // ‚úÖ Create Firebase Auth user
    const userCred =
      await createUserWithEmailAndPassword(auth, normalizedEmail, password);

    const uid = userCred.user.uid;

    // ‚úÖ Create Firestore user profile
    await setDoc(doc(db, "users", uid), {

      name: name,
      regNo: regNo,
      block: block,
      roomNo: roomNo,
      parentEmail: parentEmail,

      role: "pending_student",   // üîê cannot access yet
      approved: false,

      createdAt: serverTimestamp()

    });

    message.innerText =
      "Registration successful! Wait for admin approval.";

  }
  catch (error) {
    message.innerText = error.message;
  }

});

</script>

</body>
</html>
